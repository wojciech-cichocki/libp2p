(this.webpackJsonpapp=this.webpackJsonpapp||[]).push([[0],{145:function(e,t){},164:function(e,t){},286:function(e,t,n){var a=n(40)("\n    message Message {\n        enum Type {\n            CURRENT_STATE = 0;\n            TAKE_SEAT_REQUEST = 1;\n            RELEASE_SEAT_REQUEST = 2;\n            REQUIRES_SYNCHRONIZATION = 3;\n        }\n    \n        required Type type = 1;\n        optional CurrentState currentState = 2;\n        optional TakeSeatRequest takeSeatRequest = 3;\n        optional ReleaseSeatRequest releaseSeatRequest = 4;\n    }\n\n    message CurrentState {\n        required Seat firstSeat = 1;\n        required Seat secondSeat = 2;\n    }\n    \n    message Seat {\n          enum Type {\n            FREE = 0;\n            TAKEN = 1;\n          }\n    \n         required int64 id = 1;\n         required Type type = 2;\n         optional bytes peerId = 3;\n         required int64 timestamp = 4;\n    }\n    \n    message TakeSeatRequest {\n        required int64 id = 1;\n        required int64 timestamp = 2;\n    }\n    \n    message ReleaseSeatRequest {\n        required int64 id = 1;\n        required int64 timestamp = 2;\n    }\n").Message;e.exports={Message:a}},300:function(e,t,n){e.exports=n(758)},309:function(e,t,n){},386:function(e,t){},387:function(e,t){},419:function(e,t){},528:function(e,t){},562:function(e,t){},564:function(e,t){},595:function(e,t){},757:function(e,t,n){var a=n(23),r=n(286).Message,i=function(e){return c(e,a)},c=function(e,t){var n=Object.assign({},e);return n.peerId?Object.assign(n,{peerId:t(n.peerId)}):(delete n.peerId,n)};e.exports={decodeCurrentState:function(e){var t=r.decode(e).currentState;return{firstSeat:i(t.firstSeat),secondSeat:i(t.secondSeat)}},encodeTakeSeatRequest:function(e){var t=e.id,n=e.timestamp;return r.encode({type:r.Type.TAKE_SEAT_REQUEST,takeSeatRequest:{id:t,timestamp:n}})},decodeTakeSeatRequest:function(e){return r.decode(e).takeSeatRequest},encodeReleaseSeatRequest:function(e){var t=e.id,n=e.timestamp;return r.encode({type:r.Type.RELEASE_SEAT_REQUEST,releaseSeatRequest:{id:t,timestamp:n}})},decodeReleaseSeatRequest:function(e){return r.decode(e).releaseSeatRequest},decodeMessage:function(e){return r.decode(e)},encodeRequiresSynchronization:function(){return r.encode({type:r.Type.REQUIRES_SYNCHRONIZATION})}}},758:function(e,t,n){"use strict";n.r(t);var a,r=n(1),i=n.n(r),c=n(68),o=n.n(c),s=n(69),u=(n(309),n(0)),d=n.n(u),p=n(21),l=n(65);!function(e){e.INIT_LIB_P2P="INIT_LIB_P2P",e.SET_PEER_ID="SET_PEER_ID",e.REQUIRES_SYNCHRONIZATION_REQUEST="REQUIRES_SYNCHRONIZATION_REQUEST",e.CURRENT_STATE_RESPONSE="CURRENT_STATE_RESPONSE",e.TAKE_SEAT_REQUEST="TAKE_SEAT_REQUEST",e.TAKE_SEAT_HANDLER="TAKE_SEAT_HANDLER",e.RELEASE_SEAT_REQUEST="RELEASE_SEAT_REQUEST",e.RELEASE_SEAT_HANDLER="RELEASE_SEAT_HANDLER"}(a||(a={}));var E=function(e){return Object(l.action)(a.SET_PEER_ID,e)},f=function(e){return Object(l.action)(a.RELEASE_SEAT_HANDLER,e)},S=n(289),b=n(290),m=n(16),T=n.n(m);function v(){return(v=Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=JSON.parse(localStorage.getItem("peerId")),e.next=4,T.a.createFromJSON(t);case 4:t=e.sent,e.next=13;break;case 7:return e.prev=7,e.t0=e.catch(0),e.next=11,T.a.create();case 11:t=e.sent,localStorage.setItem("peerId",JSON.stringify(t.toJSON()));case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}var R=function(){return v.apply(this,arguments)},h=n(411),_=n(525),y=n(556),A=n(602),O=n(609).NOISE,k=n(653),I=n(656),j=n(729),g="/ip4/127.0.0.1/tcp/15555/ws/p2p-webrtc-star",N="/ip4/127.0.0.1/tcp/63786/ws/p2p/QmWjz6xb8v9K4KnYEwP5Yk75k5mMBCehzWFLCvvQpYxF3d",w=null;function x(){return(x=Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R();case 2:if(t=e.sent,null==w){e.next=5;break}return e.abrupt("return",w);case 5:return e.next=7,h.create({peerId:t,addresses:{listen:[g]},modules:{transport:[_,y],streamMuxer:[A],connEncryption:[O],peerDiscovery:[k],dht:I,pubsub:j},config:{peerDiscovery:{bootstrap:{list:[N]}},dht:{enabled:!0,randomWalk:{enabled:!0}}}});case 7:return w=e.sent,e.next=10,w.start();case 10:return e.abrupt("return",w);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U,q=function(){return x.apply(this,arguments)},C=n(286).Message,P=n(757),Q=P.encodeRequiresSynchronization,L=P.encodeTakeSeatRequest,K=P.encodeReleaseSeatRequest,z=P.decodeMessage,D=P.decodeCurrentState,H=P.decodeTakeSeatRequest,F=P.decodeReleaseSeatRequest;!function(e){e[e.CURRENT_STATE=0]="CURRENT_STATE",e[e.TAKE_SEAT_REQUEST=1]="TAKE_SEAT_REQUEST",e[e.RELEASE_SEAT_REQUEST=2]="RELEASE_SEAT_REQUEST",e[e.REQUIRES_SYNCHRONIZATION=3]="REQUIRES_SYNCHRONIZATION"}(U||(U={}));var B,M=function(){function e(t,n){Object(S.a)(this,e),this._topic=void 0,this._libp2p=void 0,this._connectedPeers=void 0,this._libp2p=t,this._topic=n,this._connectedPeers=new Set,this._libp2p.connectionManager.on("peer:connect",this.handleConnect.bind(this)),this._libp2p.connectionManager.on("peer:disconnect",this.handleDisconnect.bind(this)),this._libp2p.pubsub.start()}return Object(b.a)(e,[{key:"joinTopic",value:function(t){this._libp2p.pubsub.on(this._topic,(function(n){t(e.convertPayload(n))})),this._libp2p.pubsub.subscribe(this._topic)}},{key:"leaveTopic",value:function(){this._libp2p.pubsub.removeListener(this._topic),this._libp2p.pubsub.unsubscribe(this._topic)}},{key:"requiresSynchronization",value:function(){var e=this;setTimeout((function(){e.send(Q())}),1e3)}},{key:"takeSeat",value:function(){var e=Object(p.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.send(L({id:t,timestamp:Date.now()}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"releaseSeat",value:function(){var e=Object(p.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.send(K({id:t,timestamp:Date.now()}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPeerId",value:function(){return this._libp2p.peerId._idB58String}},{key:"send",value:function(){var e=Object(p.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._libp2p.pubsub.publish(this._topic,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleConnect",value:function(e){this._connectedPeers.has(e.remotePeer.toB58String())||(console.info("Connect with: ".concat(e.remotePeer.toB58String())),this._connectedPeers.add(e.remotePeer.toB58String()),this.requiresSynchronization())}},{key:"handleDisconnect",value:function(e){console.info("Disconnect with: ".concat(e.remotePeer.toB58String())),this._connectedPeers.delete(e.remotePeer.toB58String())}}],[{key:"convertPayload",value:function(e){var t=e.from,n=e.data,a=z(n),r=a.type,i=null;switch(a.type){case C.Type.CURRENT_STATE:i=D(n);break;case C.Type.TAKE_SEAT_REQUEST:var c=H(n);i={id:c.id,timestamp:c.timestamp,from:t};break;case C.Type.RELEASE_SEAT_REQUEST:var o=F(n);i={id:o.id,timestamp:o.timestamp,from:t}}return{from:t,messageType:r,data:i}}}]),e}();function Y(){return W.apply(this,arguments)}function W(){return(W=Object(p.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==B){e.next=2;break}return e.abrupt("return",B);case 2:return e.next=4,q();case 4:return t=e.sent,B=new M(t,"/libp2p/seats-protocol/1.0.0"),e.abrupt("return",B);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z,J=n(775),$=n(772),G=Object($.a)((function(){return{root:{display:"flex",margin:"30px"}}})),V=Object($.a)((function(){return{root:{display:"flex",width:"100%"}}})),X=n(295),ee={base:"#132743",light:"#2462b8"},te={base:"#d7385e",light:"#ff4e78"},ne={base:"#edc988",light:"#f8efd4"},ae={base:"#dcdcdc"},re={main:"#FFFFFF"},ie=(Object(X.a)({palette:{primary:{main:ee.base,contrastText:te.base},secondary:{main:ne.base},text:{primary:re.main,secondary:ee.light}},typography:{fontFamily:"Roboto",body1:{fontSize:22,lineHeight:"40px"},body2:{fontSize:16},h1:{fontSize:56},h2:{fontSize:40},h3:{fontSize:32}}}),Object($.a)((function(e){return{root:{display:"flex",height:245,width:300,padding:20,backgroundColor:ee.base,borderRadius:10,fontWeight:900,color:"#fff"}}}))),ce=n(774),oe=Object($.a)((function(e){return{status:{textAlign:"center",borderStyle:"solid",padding:10,borderWidth:2,minHeight:50,color:ne.base},skeletonStatus:{padding:10,borderWidth:2,minHeight:50,backgroundColor:ne.base}}})),se=function(e){var t=e.taken,n=e.peerId,a=e.initialized,r=oe();return i.a.createElement(J.a,{className:a?r.status:r.skeletonStatus},a?function(e,t){return e&&t?i.a.createElement(i.a.Fragment,null,i.a.createElement(ce.a,null,"Seats is taken by:"),i.a.createElement(ce.a,null,function(e,t){var n=e.substr(0,t),a=e.substr(e.length-t);return n.concat("...").concat(a)}(t,10))):i.a.createElement(ce.a,null,"Seat is free")}(t,n):i.a.createElement(i.a.Fragment,null))},ue=n(776),de=Object($.a)((function(e){return{root:{},button:{width:"100%",backgroundColor:te.base,textTransform:"lowercase",borderStyle:"solid",color:re.main,"&:hover":{backgroundColor:te.light},"&:disabled":{backgroundColor:ae.base}}}})),pe=function(e){var t=e.releasable,n=e.taken,a=e.onClick,r=e.initialized,c=de(),o=!r||n&&!t;return i.a.createElement(J.a,{className:c.root},i.a.createElement(ue.a,{className:c.button,onClick:a,disabled:o},function(e,t){return e?t?"Release":"Take the seat":"wait"}(r,n)))},le=function(e){var t=e.id,n=e.taken,r=e.releasable,c=e.peerId,o=e.initialized,u=Object(s.b)(),d=ie();return i.a.createElement(J.a,{container:!0,className:d.root,direction:"column",justify:"space-between"},i.a.createElement(se,{taken:n,peerId:c,initialized:o}),i.a.createElement(pe,{taken:n,releasable:r,onClick:function(){var e;u(r?(e=t,Object(l.action)(a.RELEASE_SEAT_REQUEST,e)):function(e){return Object(l.action)(a.TAKE_SEAT_REQUEST,e)}(t))},initialized:o}))},Ee=n(187);!function(e){e[e.FREE=0]="FREE",e[e.TAKEN=1]="TAKEN"}(Z||(Z={}));var fe=function(e,t,n){var a=null===n||void 0===n?void 0:n.type;return{id:null===n||void 0===n?void 0:n.id,peerId:null===n||void 0===n?void 0:n.peerId,taken:a===Z.TAKEN,releasable:a===Z.TAKEN&&t===(null===n||void 0===n?void 0:n.peerId),initialized:e}},Se=function(e){return e.seatState},be=(Object(Ee.a)(Se,(function(e){return e.peerId})),Object(Ee.a)(Se,(function(e){var t=[];return t.push(fe(e.init,e.peerId,e.firstSeat)),t.push(fe(e.init,e.peerId,e.secondSeat)),t}))),me=function(){var e=V(),t=Object(s.c)(be);return i.a.createElement(J.a,{container:!0,justify:"space-around",className:e.root},i.a.createElement(J.a,null,i.a.createElement(le,{id:t[0].id,taken:t[0].taken,peerId:t[0].peerId,releasable:t[0].releasable,initialized:t[0].initialized})),i.a.createElement(J.a,null,i.a.createElement(le,{id:t[1].id,taken:t[1].taken,peerId:t[1].peerId,releasable:t[1].releasable,initialized:t[1].initialized})))},Te=function(){var e=G();return i.a.createElement(J.a,{container:!0,justify:"center",alignItems:"center",className:e.root},i.a.createElement(me,null))};var ve=function(){var e=Object(s.b)(),t=function(){var t=Object(p.a)(d.a.mark((function t(){var n;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Y();case 2:(n=t.sent).joinTopic((function(t){switch(t.messageType){case U.CURRENT_STATE:if(t.from===n.getPeerId())break;e((i=t.data,Object(l.action)(a.CURRENT_STATE_RESPONSE,i)));break;case U.TAKE_SEAT_REQUEST:e((r=t.data,Object(l.action)(a.TAKE_SEAT_HANDLER,r)));break;case U.RELEASE_SEAT_REQUEST:e(f(t.data))}var r,i}));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(r.useEffect)((function(){e(Object(l.action)(a.INIT_LIB_P2P)),t()}),[]),i.a.createElement(Te,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Re=n(56),he=n(296),_e=n(42),ye=n(36),Ae=function(e,t){return{id:e.id,peerId:t.from,type:Z.TAKEN,timestamp:t.timestamp}},Oe=function(e,t){return{id:e.id,peerId:void 0,type:Z.FREE,timestamp:t.timestamp}},ke=function(e,t){return void 0===t||e===(null===t||void 0===t?void 0:t.id)&&t.type===Z.FREE},Ie=function(e,t,n){return void 0===n||n.id===e&&n.type===Z.TAKEN&&n.peerId===t},je=function(e,t){if(void 0!==e||void 0!==t)return void 0!==e&&void 0===t?e:void 0===e&&void 0!==t?t:e>=t?e:t},ge={init:!1},Ne=d.a.mark(Ke),we=d.a.mark(ze),xe=d.a.mark(De),Ue=d.a.mark(He),qe=d.a.mark(Fe),Ce=d.a.mark(Be),Pe=d.a.mark(Me),Qe=d.a.mark(Ye),Le=d.a.mark(We);function Ke(){var e;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Y();case 2:return e=t.sent,t.next=5,e.requiresSynchronization();case 5:return t.next=7,Object(_e.c)(E(e.getPeerId()));case 7:case"end":return t.stop()}}),Ne)}function ze(){var e;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Y();case 2:return e=t.sent,t.next=5,Object(_e.c)(E(e.getPeerId()));case 5:case"end":return t.stop()}}),we)}function De(e){var t;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Y();case 2:return t=n.sent,n.next=5,t.takeSeat(e.payload);case 5:case"end":return n.stop()}}),xe)}function He(e){var t;return d.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Y();case 2:return t=n.sent,n.next=5,t.releaseSeat(e.payload);case 5:case"end":return n.stop()}}),Ue)}function Fe(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_e.d)(a.INIT_LIB_P2P,ze);case 2:case"end":return e.stop()}}),qe)}function Be(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_e.d)(a.REQUIRES_SYNCHRONIZATION_REQUEST,Ke);case 2:case"end":return e.stop()}}),Ce)}function Me(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_e.d)(a.TAKE_SEAT_REQUEST,De);case 2:case"end":return e.stop()}}),Pe)}function Ye(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_e.d)(a.RELEASE_SEAT_REQUEST,He);case 2:case"end":return e.stop()}}),Qe)}function We(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_e.a)([Object(_e.b)(Fe),Object(_e.b)(Be),Object(_e.b)(Me),Object(_e.b)(Ye)]);case 2:case"end":return e.stop()}}),Le)}var Ze=d.a.mark($e),Je=Object(Re.combineReducers)({seatState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ge,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case a.SET_PEER_ID:return Object(ye.a)(Object(ye.a)({},e),{},{peerId:t.payload});case a.CURRENT_STATE_RESPONSE:var n,r,i=t.payload,c=i.firstSeat,o=i.secondSeat,s=je(null===(n=e.firstSeat)||void 0===n?void 0:n.timestamp,null===(r=e.secondSeat)||void 0===r?void 0:r.timestamp),u=je(null===c||void 0===c?void 0:c.timestamp,null===o||void 0===o?void 0:o.timestamp);return void 0===s||void 0!==u&&u>s?Object(ye.a)(Object(ye.a)(Object(ye.a)({},e),t.payload),{},{init:!0}):e;case a.TAKE_SEAT_HANDLER:var d=t.payload.id;if(ke(d,e.firstSeat)){var p=Ae(e.firstSeat,t.payload);return Object(ye.a)(Object(ye.a)({},e),{},{firstSeat:p})}if(ke(d,e.secondSeat)){var l=Ae(e.secondSeat,t.payload);return Object(ye.a)(Object(ye.a)({},e),{},{secondSeat:l})}return e;case a.RELEASE_SEAT_HANDLER:var E=t.payload,f=E.id,S=E.from;if(Ie(f,S,e.firstSeat)){var b=Oe(e.firstSeat,t.payload);return Object(ye.a)(Object(ye.a)({},e),{},{firstSeat:b})}if(Ie(f,S,e.secondSeat)){var m=Oe(e.secondSeat,t.payload);return Object(ye.a)(Object(ye.a)({},e),{},{secondSeat:m})}return e;default:return e}}});function $e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(_e.a)([Object(_e.b)(We)]);case 2:case"end":return e.stop()}}),Ze)}var Ge=n(294);var Ve=function(e){var t=Object(Ge.composeWithDevTools)({}),n=Object(he.a)(),a=Object(Re.createStore)(Je,e,t(Object(Re.applyMiddleware)(n)));return n.run($e),a}({seatState:{init:!1}});o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(s.a,{store:Ve},i.a.createElement(ve,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[300,1,2]]]);
//# sourceMappingURL=main.c8c559ca.chunk.js.map